<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>gettit.js</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>gettit.js</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>True when url param debug_assets=true.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">isDebugging</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>Jammit dependency management/config file.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">assets</span><span class="o">:</span> <span class="s1">&#39;assets.yml&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>List of javascript assets; name of assets should match <code>javascripts</code> packages defined in assets.yml.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">jsAssets</span><span class="o">:</span> <span class="p">[],</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>List of css assets; name of assets should match <code>stylesheets</code> packages defined in assets.yml.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">cssAssets</span><span class="o">:</span> <span class="p">[],</span> </pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Environment which determines how gettit loads.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">env</span><span class="o">:</span> <span class="s1">&#39;production&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>Prepended to <code>jsAssets</code> and <code>cssAssets</code> when fetching files.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>The namespace where templates are compiled.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">templateNs</span><span class="o">:</span> <span class="s1">&#39;window.JST&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>The extension used to identify javascript templates.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">templateExt</span><span class="o">:</span> <span class="s1">&#39;jst&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>The function used to compile javascript templates.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">templateFunc</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Version number appended to request urls as a query param. Useful for busting cache.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">version</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Callback called after all javascripts/templates are loaded.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">cb</span><span class="o">:</span> <span class="s1">&#39;(function(){})&#39;</span>
  <span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Use the <code>options</code> to find out what mode/environment we are in &ndash; production or 
debug/development &ndash; and load assets accordingly. In production, load js and css
using the given <code>options</code>. In debug/development, fetch the <code>options.assets</code> file.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">),</span>
      <span class="nx">cb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">params</span><span class="p">.</span><span class="nx">cb</span> <span class="o">&amp;&amp;</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">cb</span><span class="o">+</span><span class="s1">&#39;()&#39;</span><span class="p">);</span> <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">cacheBust</span> <span class="o">=</span> <span class="s1">&#39;?r=&#39;</span> <span class="o">+</span> <span class="nx">params</span><span class="p">.</span><span class="nx">version</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">env</span> <span class="o">==</span> <span class="s1">&#39;production&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">isDebugging</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>Production mode &ndash; fetch assets from params directly.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">fetchAssets</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">jsAssets</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">cssAssets</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="nx">cacheBust</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Development/debug mode &ndash; get package names from the filenames in <code>jsAssets</code> and <code>cssAssets</code>. </p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="kd">var</span> <span class="nx">jsPackages</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">cssPackages</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">each</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">jsAssets</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">asset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jsPackages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">getFileName</span><span class="p">(</span><span class="nx">asset</span><span class="p">));</span>
      <span class="p">});</span>
      <span class="nx">each</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">cssAssets</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">asset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cssPackages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">getFileName</span><span class="p">(</span><span class="nx">asset</span><span class="p">));</span>
      <span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>Fetch the yaml file. In the callback, parse out and fetch the scripts, templates, and stylesheets.  </p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">fetchText</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">path</span><span class="o">+</span><span class="nx">params</span><span class="p">.</span><span class="nx">assets</span><span class="p">,</span> <span class="nx">cacheBust</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">yaml</span> <span class="o">=</span> <span class="nx">YAML</span><span class="p">.</span><span class="nb">eval</span><span class="p">(</span><span class="nx">text</span><span class="p">),</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">css</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">templates</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">extend</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">templateFunc</span><span class="o">:</span> <span class="nx">yaml</span><span class="p">.</span><span class="nx">template_function</span><span class="p">,</span>
          <span class="nx">templateNs</span><span class="o">:</span> <span class="nx">yaml</span><span class="p">.</span><span class="nx">template_namespace</span><span class="p">,</span>
          <span class="nx">templateExt</span><span class="o">:</span> <span class="nx">yaml</span><span class="p">.</span><span class="nx">template_extension</span>
        <span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>Use the <code>javascripts</code> yaml definition to create <code>scripts</code> and <code>templates</code> file lists.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="nx">each</span><span class="p">(</span><span class="nx">keys</span><span class="p">(</span><span class="nx">yaml</span><span class="p">.</span><span class="nx">javascripts</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">packageName</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">jsPackages</span><span class="p">,</span> <span class="nx">packageName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">each</span><span class="p">(</span><span class="nx">yaml</span><span class="p">.</span><span class="nx">javascripts</span><span class="p">[</span><span class="nx">packageName</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">js</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span><span class="p">(</span><span class="nx">js</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">js</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;.js&#39;</span><span class="p">)</span>
                <span class="nx">scripts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">js</span><span class="p">);</span>
              <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">js</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">js</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="nx">params</span><span class="p">.</span><span class="nx">templateExt</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">==</span> <span class="nx">params</span><span class="p">.</span><span class="nx">templateExt</span><span class="p">)</span>
                <span class="nx">templates</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">js</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
        </pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>Use the <code>stylesheets</code> yaml definition to create a <code>css</code> file list.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="nx">each</span><span class="p">(</span><span class="nx">keys</span><span class="p">(</span><span class="nx">yaml</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">packageName</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">cssPackages</span><span class="p">,</span> <span class="nx">packageName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">yaml</span><span class="p">.</span><span class="nx">stylesheets</span><span class="p">[</span><span class="nx">packageName</span><span class="p">]);</span>
        <span class="p">});</span>
      </pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Fetch the assets parsed from yaml. In the callback, fetch and compile the templates.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="nx">fetchAssets</span><span class="p">(</span><span class="nx">scripts</span><span class="p">,</span> <span class="nx">css</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="nx">cacheBust</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">templates</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">cb</span><span class="p">();</span>
          <span class="kd">var</span> <span class="nx">nTemplates</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="nx">each</span><span class="p">(</span><span class="nx">templates</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">template</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fetchText</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">path</span><span class="o">+</span><span class="nx">template</span><span class="p">,</span> <span class="nx">cacheBust</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">templateCompiler</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">templateNs</span><span class="p">,</span> <span class="nx">getFileName</span><span class="p">(</span><span class="nx">template</span><span class="p">),</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">templateFunc</span><span class="p">);</span>
              <span class="k">if</span><span class="p">(</span><span class="o">++</span><span class="nx">nTemplates</span> <span class="o">===</span> <span class="nx">templates</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">cb</span><span class="p">();</span>
            <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-Utilities'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Utilities">&#182;</a>
        </div>
        <h2>Utilities</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre>  </pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>Given arrays of <code>js</code> and <code>css</code> files, prepends the <code>path</code> and fetches them. Javascript is
downloaded in parallel, but executed in order. If <code>bust</code> is defined, then that value is 
appended to each url. The callback ,<code>cb</code>, is fired after the last javascript executes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">function</span> <span class="nx">fetchAssets</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="nx">css</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">bust</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">css</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">each</span><span class="p">(</span><span class="nx">css</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span> 
        <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;://&#39;</span><span class="p">)</span>  <span class="o">&gt;</span>  <span class="mi">0</span>  <span class="o">?</span> <span class="nx">file</span> <span class="o">:</span> <span class="nx">path</span> <span class="o">+</span> <span class="nx">file</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">bust</span><span class="o">?</span><span class="nx">bust</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">rel</span> <span class="o">=</span> <span class="s1">&#39;stylesheet&#39;</span><span class="p">;</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;text/css&#39;</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">each</span><span class="p">(</span><span class="nx">js</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">jsfile</span> <span class="o">=</span> <span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;://&#39;</span><span class="p">)</span>  <span class="o">&gt;</span>  <span class="mi">0</span>  <span class="o">?</span> <span class="nx">file</span> <span class="o">:</span> <span class="nx">path</span> <span class="o">+</span> <span class="nx">file</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">bust</span><span class="o">?</span><span class="nx">bust</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="nx">loader</span><span class="p">.</span><span class="nx">$LAB</span><span class="p">.</span><span class="nx">queueScript</span><span class="p">(</span><span class="nx">jsfile</span><span class="p">).</span><span class="nx">queueWait</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">loader</span><span class="p">.</span><span class="nx">$LAB</span><span class="p">.</span><span class="nx">queueWait</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">cb</span> <span class="o">&amp;&amp;</span> <span class="nx">cb</span><span class="p">();</span> <span class="p">});</span>
    <span class="nx">loader</span><span class="p">.</span><span class="nx">$LAB</span><span class="p">.</span><span class="nx">runQueue</span><span class="p">();</span>
  <span class="p">}</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>Using xhr, fetches the text file at the given <code>url</code>. If <code>bust</code> is defined, then that value is 
appended to the fetch url. The callback, <code>cb</code>, is fired with the returned <code>responseText</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">function</span> <span class="nx">fetchText</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">bust</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">isIE</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">appName</span> <span class="o">==</span> <span class="s1">&#39;Microsoft Internet Explorer&#39;</span><span class="p">,</span>
      <span class="nx">isCrossDomain</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;://&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="sr">/^\w+\:\/\/\/?[^\/]+/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">url</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sr">/^\w+\:\/\/\/?[^\/]+/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    </pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>Setup a CORS request object for IE8+.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">isIE</span> <span class="o">&amp;&amp;</span> <span class="nx">isCrossDomain</span><span class="p">)</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XDomainRequest</span><span class="p">();</span>
    <span class="k">else</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">url</span> <span class="o">+</span> <span class="p">(</span><span class="nx">bust</span><span class="o">?</span><span class="nx">bust</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>Compiles templates using the defined <code>compile</code> api to the given <code>namespace</code>, with 
the given <code>name</code>, compiled with the given <code>text</code>. If <code>func</code> is defined, then it will 
be evluated and used to compile the template; otherwise, templates are compiled with 
a variant of John Resig&rsquo;s micro templating.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">templateCompiler</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">compileMicroTemplate</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">obj</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">return</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&quot;obj&quot;</span><span class="p">,</span><span class="s2">&quot;var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push(&#39;&quot;</span><span class="o">+</span><span class="nx">a</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span><span class="s2">&quot;\\\\&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;/g</span><span class="p">,</span><span class="s2">&quot;\\&#39;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;%=([\s\S]+?)%&gt;/g</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="k">return</span><span class="s2">&quot;&#39;,&quot;</span><span class="o">+</span><span class="nx">c</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\&#39;/g</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&#39;&quot;</span><span class="p">}).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;%([\s\S]+?)%&gt;/g</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="k">return</span><span class="s2">&quot;&#39;);&quot;</span><span class="o">+</span><span class="nx">c</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\&#39;/g</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\r\n\t]/g</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;__p.push(&#39;&quot;</span><span class="p">}).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\r/g</span><span class="p">,</span><span class="s2">&quot;\\r&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;\\n&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\t/g</span><span class="p">,</span><span class="s2">&quot;\\t&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;);}return __p.join(&#39;&#39;);&quot;</span><span class="p">)}(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">compileFunctionTemplate</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span> <span class="s1">&#39;\\&quot;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(\r)?\n/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="nx">obj</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">func</span><span class="o">+</span><span class="s1">&#39;(&quot;&#39;</span><span class="o">+</span><span class="nx">text</span><span class="o">+</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">compile</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">templateObj</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">namespace</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">namespace</span> <span class="o">+</span> <span class="s1">&#39;||{};&#39;</span><span class="p">);</span>
        
        <span class="k">if</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="nx">compileFunctionTemplate</span><span class="p">(</span><span class="nx">templateObj</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">func</span><span class="p">);</span>
        <span class="k">else</span> <span class="nx">compileMicroTemplate</span><span class="p">(</span><span class="nx">templateObj</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})();</span>
  
  <span class="kd">function</span> <span class="nx">each</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">iterator</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">array</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">array</span> <span class="o">&amp;&amp;</span> <span class="nx">iterator</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">array</span><span class="p">)</span> <span class="o">===</span> <span class="p">{})</span> <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>				
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">keys</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">indexOf</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">array</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">item</span><span class="p">)</span> <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">each</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">!==</span> <span class="k">void</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">trim</span><span class="p">(</span><span class="nx">str</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="o">--</span><span class="nx">end</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">33</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="o">++</span><span class="nx">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">33</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">getFileName</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">path</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/(\w*)\.\w*$/</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-Script_Loader'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Script_Loader">&#182;</a>
        </div>
        <h2>Script Loader</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre>  </pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>Ecapsulates the $LAB.js object &ndash; passed into the anonoymous function.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">loader</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
      </td>
    </tr>
    <tr id='section-27'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-27">&#182;</a>
        </div>
        <p>LAB.js (LABjs :: Loading And Blocking JavaScript)<br>
v2.0.3 &copy; Kyle Simpson<br>
MIT License  </p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">){</span><span class="kd">var</span> <span class="nx">K</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">$LAB</span><span class="p">,</span><span class="nx">y</span><span class="o">=</span><span class="s2">&quot;UseLocalXHR&quot;</span><span class="p">,</span><span class="nx">z</span><span class="o">=</span><span class="s2">&quot;AlwaysPreserveOrder&quot;</span><span class="p">,</span><span class="nx">u</span><span class="o">=</span><span class="s2">&quot;AllowDuplicates&quot;</span><span class="p">,</span><span class="nx">A</span><span class="o">=</span><span class="s2">&quot;CacheBust&quot;</span><span class="p">,</span><span class="nx">B</span><span class="o">=</span><span class="s2">&quot;BasePath&quot;</span><span class="p">,</span><span class="nx">C</span><span class="o">=</span><span class="sr">/^[^?#]*\//</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="nx">D</span><span class="o">=</span><span class="sr">/^\w+\:\/\/\/?[^\/]+/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">C</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="nx">i</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="o">||</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">),</span><span class="nx">L</span><span class="o">=</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">opera</span><span class="o">&amp;&amp;</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">opera</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;[object Opera]&quot;</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="s2">&quot;MozAppearance&quot;</span><span class="k">in</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">),</span><span class="nx">q</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">),</span><span class="nx">E</span><span class="o">=</span><span class="k">typeof</span> <span class="nx">q</span><span class="p">.</span><span class="nx">preload</span><span class="o">==</span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span><span class="nx">r</span><span class="o">=</span><span class="nx">E</span><span class="o">||</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">readyState</span><span class="o">&amp;&amp;</span><span class="nx">q</span><span class="p">.</span><span class="nx">readyState</span><span class="o">==</span><span class="s2">&quot;uninitialized&quot;</span><span class="p">),</span><span class="nx">F</span><span class="o">=!</span><span class="nx">r</span><span class="o">&amp;&amp;</span><span class="nx">q</span><span class="p">.</span><span class="nx">async</span><span class="o">===</span><span class="kc">true</span><span class="p">,</span><span class="nx">M</span><span class="o">=!</span><span class="nx">r</span><span class="o">&amp;&amp;!</span><span class="nx">F</span><span class="o">&amp;&amp;!</span><span class="nx">L</span><span class="p">;</span><span class="kd">function</span> <span class="nx">G</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;[object Function]&quot;</span><span class="p">}</span><span class="kd">function</span> <span class="nx">H</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;[object Array]&quot;</span><span class="p">}</span><span class="kd">function</span> <span class="nx">N</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="sr">/^\w+\:\/\//</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="sr">/^\/\/\/?/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">a</span><span class="p">)){</span><span class="nx">a</span><span class="o">=</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span><span class="o">+</span><span class="nx">a</span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">!=</span><span class="s2">&quot;/&quot;</span><span class="p">){</span><span class="nx">a</span><span class="o">=</span><span class="p">(</span><span class="nx">c</span><span class="o">||</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">+</span><span class="nx">a</span><span class="p">}</span><span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">?</span><span class="nx">a</span><span class="o">:</span><span class="p">((</span><span class="nx">a</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;/&quot;</span><span class="o">?</span><span class="nx">D</span><span class="o">:</span><span class="nx">C</span><span class="p">)</span><span class="o">+</span><span class="nx">a</span><span class="p">)}</span><span class="kd">function</span> <span class="nx">s</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">b</span> <span class="k">in</span> <span class="nx">a</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">b</span><span class="p">)){</span><span class="nx">c</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]}}</span><span class="k">return</span> <span class="nx">c</span><span class="p">}</span><span class="kd">function</span> <span class="nx">O</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">b</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">b</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">scripts</span><span class="p">[</span><span class="nx">b</span><span class="p">].</span><span class="nx">ready</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">scripts</span><span class="p">[</span><span class="nx">b</span><span class="p">].</span><span class="nx">exec_trigger</span><span class="p">){</span><span class="nx">c</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">scripts</span><span class="p">[</span><span class="nx">b</span><span class="p">].</span><span class="nx">exec_trigger</span><span class="p">();</span><span class="nx">a</span><span class="p">.</span><span class="nx">scripts</span><span class="p">[</span><span class="nx">b</span><span class="p">].</span><span class="nx">exec_trigger</span><span class="o">=</span><span class="kc">null</span><span class="p">}}</span><span class="k">return</span> <span class="nx">c</span><span class="p">}</span><span class="kd">function</span> <span class="nx">t</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="p">.</span><span class="nx">readyState</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">readyState</span><span class="o">!=</span><span class="s2">&quot;complete&quot;</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">readyState</span><span class="o">!=</span><span class="s2">&quot;loaded&quot;</span><span class="p">)</span><span class="o">||</span><span class="nx">c</span><span class="p">[</span><span class="nx">b</span><span class="p">])</span><span class="k">return</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="nx">d</span><span class="p">()}}</span><span class="kd">function</span> <span class="nx">I</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">ready</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">finished</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">finished_listeners</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">c</span><span class="o">++</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">finished_listeners</span><span class="p">[</span><span class="nx">c</span><span class="p">]()}</span><span class="nx">a</span><span class="p">.</span><span class="nx">ready_listeners</span><span class="o">=</span><span class="p">[];</span><span class="nx">a</span><span class="p">.</span><span class="nx">finished_listeners</span><span class="o">=</span><span class="p">[]}</span><span class="kd">function</span> <span class="nx">P</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">f</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">h</span><span class="p">){</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">real_src</span><span class="p">,</span><span class="nx">b</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="k">in</span> <span class="nx">i</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]){</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span><span class="mi">25</span><span class="p">);</span><span class="k">return</span><span class="p">}</span><span class="nx">i</span><span class="o">=</span><span class="nx">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span><span class="nx">a</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="nx">a</span><span class="p">.</span><span class="nx">type</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">charset</span><span class="p">)</span><span class="nx">a</span><span class="p">.</span><span class="nx">charset</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">charset</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">h</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">elem</span><span class="o">=</span><span class="nx">a</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">E</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">preload</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">onpreload</span><span class="o">=</span><span class="nx">g</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="nx">a</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">readyState</span><span class="o">==</span><span class="s2">&quot;loaded&quot;</span><span class="p">)</span><span class="nx">g</span><span class="p">()}}</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">c</span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">h</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">D</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="nx">d</span><span class="p">[</span><span class="nx">y</span><span class="p">]){</span><span class="nx">b</span><span class="o">=</span><span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span><span class="nx">b</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">readyState</span><span class="o">==</span><span class="mi">4</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="o">=</span><span class="kd">function</span><span class="p">(){};</span><span class="nx">e</span><span class="p">.</span><span class="nx">text</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">responseText</span><span class="o">+</span><span class="s2">&quot;\n//@ sourceURL=&quot;</span><span class="o">+</span><span class="nx">c</span><span class="p">;</span><span class="nx">g</span><span class="p">()}};</span><span class="nx">b</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="nx">c</span><span class="p">);</span><span class="nx">b</span><span class="p">.</span><span class="nx">send</span><span class="p">()}</span><span class="k">else</span><span class="p">{</span><span class="nx">a</span><span class="p">.</span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/cache-script&quot;</span><span class="p">;</span><span class="nx">t</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="s2">&quot;ready&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">i</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="nx">g</span><span class="p">()});</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="nx">i</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">)}}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">F</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">async</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">t</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="s2">&quot;finished&quot;</span><span class="p">,</span><span class="nx">g</span><span class="p">);</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="nx">i</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="nx">t</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="s2">&quot;finished&quot;</span><span class="p">,</span><span class="nx">g</span><span class="p">);</span><span class="nx">a</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="nx">i</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">)}},</span><span class="mi">0</span><span class="p">)}</span><span class="kd">function</span> <span class="nx">J</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">l</span><span class="o">=</span><span class="p">{},</span><span class="nx">Q</span><span class="o">=</span><span class="nx">r</span><span class="o">||</span><span class="nx">M</span><span class="p">,</span><span class="nx">n</span><span class="o">=</span><span class="p">[],</span><span class="nx">p</span><span class="o">=</span><span class="p">{},</span><span class="nx">m</span><span class="p">;</span><span class="nx">l</span><span class="p">[</span><span class="nx">y</span><span class="p">]</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">l</span><span class="p">[</span><span class="nx">z</span><span class="p">]</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">l</span><span class="p">[</span><span class="nx">u</span><span class="p">]</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">l</span><span class="p">[</span><span class="nx">A</span><span class="p">]</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">l</span><span class="p">[</span><span class="nx">B</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="kd">function</span> <span class="nx">R</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="kd">var</span> <span class="nx">d</span><span class="p">;</span><span class="kd">function</span> <span class="nx">f</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="o">!=</span><span class="kc">null</span><span class="p">){</span><span class="nx">d</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="nx">I</span><span class="p">(</span><span class="nx">b</span><span class="p">)}}</span><span class="k">if</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">src</span><span class="p">].</span><span class="nx">finished</span><span class="p">)</span><span class="k">return</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">[</span><span class="nx">u</span><span class="p">])</span><span class="nx">p</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">src</span><span class="p">].</span><span class="nx">finished</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">d</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">elem</span><span class="o">||</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span><span class="nx">d</span><span class="p">.</span><span class="nx">type</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">charset</span><span class="p">)</span><span class="nx">d</span><span class="p">.</span><span class="nx">charset</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">charset</span><span class="p">;</span><span class="nx">t</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="s2">&quot;finished&quot;</span><span class="p">,</span><span class="nx">f</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">elem</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">elem</span><span class="o">=</span><span class="kc">null</span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">text</span><span class="p">){</span><span class="nx">d</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="nx">d</span><span class="p">.</span><span class="nx">text</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="nx">d</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">real_src</span><span class="p">}</span><span class="nx">i</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">text</span><span class="p">){</span><span class="nx">f</span><span class="p">()}}</span><span class="kd">function</span> <span class="nx">S</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">f</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nx">b</span><span class="p">.</span><span class="nx">ready_cb</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">R</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">e</span><span class="p">)})},</span><span class="nx">j</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nx">b</span><span class="p">.</span><span class="nx">finished_cb</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">)};</span><span class="nx">b</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">N</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">src</span><span class="p">,</span><span class="nx">c</span><span class="p">[</span><span class="nx">B</span><span class="p">]);</span><span class="nx">b</span><span class="p">.</span><span class="nx">real_src</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">src</span><span class="o">+</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="nx">A</span><span class="p">]</span><span class="o">?</span><span class="p">((</span><span class="sr">/\?.*$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">src</span><span class="p">)</span><span class="o">?</span><span class="s2">&quot;&amp;_&quot;</span><span class="o">:</span><span class="s2">&quot;?_&quot;</span><span class="p">)</span><span class="o">+~~</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">1</span><span class="nx">E9</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="p">)</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">p</span><span class="p">[</span><span class="nx">b</span><span class="p">.</span><span class="nx">src</span><span class="p">])</span><span class="nx">p</span><span class="p">[</span><span class="nx">b</span><span class="p">.</span><span class="nx">src</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nx">items</span><span class="o">:</span><span class="p">[],</span><span class="nx">finished</span><span class="o">:</span><span class="kc">false</span><span class="p">};</span><span class="nx">g</span><span class="o">=</span><span class="nx">p</span><span class="p">[</span><span class="nx">b</span><span class="p">.</span><span class="nx">src</span><span class="p">].</span><span class="nx">items</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="nx">u</span><span class="p">]</span><span class="o">||</span><span class="nx">g</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="nx">g</span><span class="p">[</span><span class="nx">g</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nx">ready</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">finished</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">ready_listeners</span><span class="o">:</span><span class="p">[</span><span class="nx">h</span><span class="p">],</span><span class="nx">finished_listeners</span><span class="o">:</span><span class="p">[</span><span class="nx">j</span><span class="p">]};</span><span class="nx">P</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">e</span><span class="p">,((</span><span class="nx">f</span><span class="p">)</span><span class="o">?</span><span class="kd">function</span><span class="p">(){</span><span class="nx">e</span><span class="p">.</span><span class="nx">ready</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">.</span><span class="nx">ready_listeners</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">ready_listeners</span><span class="p">[</span><span class="nx">a</span><span class="p">]()}</span><span class="nx">e</span><span class="p">.</span><span class="nx">ready_listeners</span><span class="o">=</span><span class="p">[]}</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="nx">I</span><span class="p">(</span><span class="nx">e</span><span class="p">)}),</span><span class="nx">f</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="nx">e</span><span class="o">=</span><span class="nx">g</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">finished</span><span class="p">){</span><span class="nx">j</span><span class="p">()}</span><span class="k">else</span><span class="p">{</span><span class="nx">e</span><span class="p">.</span><span class="nx">finished_listeners</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">j</span><span class="p">)}}}</span><span class="kd">function</span> <span class="nx">v</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="p">,</span><span class="nx">g</span><span class="o">=</span><span class="nx">s</span><span class="p">(</span><span class="nx">l</span><span class="p">,{}),</span><span class="nx">h</span><span class="o">=</span><span class="p">[],</span><span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">w</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span><span class="nx">k</span><span class="p">;</span><span class="kd">function</span> <span class="nx">T</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">ready</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">exec_trigger</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="nx">x</span><span class="p">()}</span><span class="kd">function</span> <span class="nx">U</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">ready</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">finished</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">exec_trigger</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">b</span><span class="o">&lt;</span><span class="nx">c</span><span class="p">.</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">b</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">scripts</span><span class="p">[</span><span class="nx">b</span><span class="p">].</span><span class="nx">finished</span><span class="p">)</span><span class="k">return</span><span class="p">}</span><span class="nx">c</span><span class="p">.</span><span class="nx">finished</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">x</span><span class="p">()}</span><span class="kd">function</span> <span class="nx">x</span><span class="p">(){</span><span class="k">while</span><span class="p">(</span><span class="nx">j</span><span class="o">&lt;</span><span class="nx">h</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">G</span><span class="p">(</span><span class="nx">h</span><span class="p">[</span><span class="nx">j</span><span class="p">])){</span><span class="k">try</span><span class="p">{</span><span class="nx">h</span><span class="p">[</span><span class="nx">j</span><span class="o">++</span><span class="p">]()}</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">){}</span><span class="k">continue</span><span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">finished</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">O</span><span class="p">(</span><span class="nx">h</span><span class="p">[</span><span class="nx">j</span><span class="p">]))</span><span class="k">continue</span><span class="p">;</span><span class="k">break</span><span class="p">}</span><span class="nx">j</span><span class="o">++</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="nx">j</span><span class="o">==</span><span class="nx">h</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="nx">w</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">k</span><span class="o">=</span><span class="kc">false</span><span class="p">}}</span><span class="kd">function</span> <span class="nx">V</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">k</span><span class="o">||!</span><span class="nx">k</span><span class="p">.</span><span class="nx">scripts</span><span class="p">){</span><span class="nx">h</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="o">=</span><span class="p">{</span><span class="nx">scripts</span><span class="o">:</span><span class="p">[],</span><span class="nx">finished</span><span class="o">:</span><span class="kc">true</span><span class="p">})}}</span><span class="nx">e</span><span class="o">=</span><span class="p">{</span><span class="nx">script</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">f</span><span class="o">&lt;</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">f</span><span class="o">++</span><span class="p">){(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">b</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">H</span><span class="p">(</span><span class="nx">a</span><span class="p">)){</span><span class="nx">c</span><span class="o">=</span><span class="p">[</span><span class="nx">a</span><span class="p">]}</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">d</span><span class="o">&lt;</span><span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">d</span><span class="o">++</span><span class="p">){</span><span class="nx">V</span><span class="p">();</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">[</span><span class="nx">d</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">G</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">H</span><span class="p">(</span><span class="nx">a</span><span class="p">)){</span><span class="nx">b</span><span class="o">=</span><span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="nx">b</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="mi">1</span><span class="p">);[].</span><span class="nx">splice</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="p">);</span><span class="nx">d</span><span class="o">--</span><span class="p">;</span><span class="k">continue</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">a</span><span class="o">==</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="nx">src</span><span class="o">:</span><span class="nx">a</span><span class="p">};</span><span class="nx">a</span><span class="o">=</span><span class="nx">s</span><span class="p">(</span><span class="nx">a</span><span class="p">,{</span><span class="nx">ready</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">ready_cb</span><span class="o">:</span><span class="nx">T</span><span class="p">,</span><span class="nx">finished</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">finished_cb</span><span class="o">:</span><span class="nx">U</span><span class="p">});</span><span class="nx">k</span><span class="p">.</span><span class="nx">finished</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">k</span><span class="p">.</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="nx">S</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">k</span><span class="p">,(</span><span class="nx">Q</span><span class="o">&amp;&amp;</span><span class="nx">w</span><span class="p">));</span><span class="nx">w</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="p">[</span><span class="nx">z</span><span class="p">])</span><span class="nx">e</span><span class="p">.</span><span class="nx">wait</span><span class="p">()}})(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">f</span><span class="p">],</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">f</span><span class="p">])}</span><span class="k">return</span> <span class="nx">e</span><span class="p">},</span><span class="nx">wait</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">){</span><span class="nx">h</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">a</span><span class="p">])}</span><span class="nx">k</span><span class="o">=</span><span class="nx">h</span><span class="p">[</span><span class="nx">h</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span><span class="k">else</span> <span class="nx">k</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">x</span><span class="p">();</span><span class="k">return</span> <span class="nx">e</span><span class="p">}};</span><span class="k">return</span><span class="p">{</span><span class="nx">script</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">script</span><span class="p">,</span><span class="nx">wait</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">wait</span><span class="p">,</span><span class="nx">setOptions</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="nx">s</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">g</span><span class="p">);</span><span class="k">return</span> <span class="nx">e</span><span class="p">}}}</span><span class="nx">m</span><span class="o">=</span><span class="p">{</span><span class="nx">setGlobalDefaults</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="nx">s</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">l</span><span class="p">);</span><span class="k">return</span> <span class="nx">m</span><span class="p">},</span><span class="nx">setOptions</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">v</span><span class="p">().</span><span class="nx">setOptions</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">script</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">v</span><span class="p">().</span><span class="nx">script</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">wait</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">v</span><span class="p">().</span><span class="nx">wait</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">queueScript</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="nx">n</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="nx">args</span><span class="o">:</span><span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)};</span><span class="k">return</span> <span class="nx">m</span><span class="p">},</span><span class="nx">queueWait</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="nx">n</span><span class="p">[</span><span class="nx">n</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="s2">&quot;wait&quot;</span><span class="p">,</span><span class="nx">args</span><span class="o">:</span><span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)};</span><span class="k">return</span> <span class="nx">m</span><span class="p">},</span><span class="nx">runQueue</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">m</span><span class="p">,</span><span class="nx">c</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span><span class="nx">b</span><span class="o">=</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">;</span><span class="k">for</span><span class="p">(;</span><span class="o">--</span><span class="nx">b</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;){</span><span class="nx">d</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">type</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">d</span><span class="p">.</span><span class="nx">args</span><span class="p">)}</span><span class="k">return</span> <span class="nx">a</span><span class="p">},</span><span class="nx">noConflict</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="nx">o</span><span class="p">.</span><span class="nx">$LAB</span><span class="o">=</span><span class="nx">K</span><span class="p">;</span><span class="k">return</span> <span class="nx">m</span><span class="p">},</span><span class="nx">sandbox</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">J</span><span class="p">()}};</span><span class="k">return</span> <span class="nx">m</span><span class="p">}</span><span class="nx">o</span><span class="p">.</span><span class="nx">$LAB</span><span class="o">=</span><span class="nx">J</span><span class="p">();(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span><span class="o">==</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nb">document</span><span class="p">[</span><span class="nx">a</span><span class="p">]){</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span><span class="o">=</span><span class="s2">&quot;loading&quot;</span><span class="p">;</span><span class="nb">document</span><span class="p">[</span><span class="nx">a</span><span class="p">](</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="kc">false</span><span class="p">);</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span><span class="o">=</span><span class="s2">&quot;complete&quot;</span><span class="p">},</span><span class="kc">false</span><span class="p">)}})(</span><span class="s2">&quot;addEventListener&quot;</span><span class="p">,</span><span class="s2">&quot;DOMContentLoaded&quot;</span><span class="p">)})(</span><span class="nx">loader</span><span class="p">);</span>
  
  
  <span class="nx">loader</span><span class="p">.</span><span class="nx">$LAB</span><span class="p">.</span><span class="nx">setOptions</span><span class="p">({</span><span class="nx">AlwaysPreserveOrder</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">AllowDuplicates</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-Yaml_Parser'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Yaml_Parser">&#182;</a>
        </div>
        <h2>Yaml Parser</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>Slightly reduced, modified, and fixed with original credit going to:<br>
Author: Diogo Costa<br>
This program is released under the MIT License as follows:<br>
Copyright &copy; 2011 Diogo Costa (costa.h4evr@gmail.com)  </p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">YAML</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">reference_blocks</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">regex</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;regLevel&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^([\\s\\-]+)&quot;</span><span class="p">),</span>
        <span class="s2">&quot;invalidLine&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\-\\-\\-|^\\.\\.\\.|^\\s*#.*|^\\s*$&quot;</span><span class="p">),</span>
        <span class="s2">&quot;dashesString&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\s*\\\&quot;([^\\\&quot;]*)\\\&quot;\\s*$&quot;</span><span class="p">),</span>
        <span class="s2">&quot;quotesString&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\s*\\\&#39;([^\\\&#39;]*)\\\&#39;\\s*$&quot;</span><span class="p">),</span>
        <span class="s2">&quot;float&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^[+-]?[0-9]+\\.[0-9]+(e[+-]?[0-9]+(\\.[0-9]+)?)?$&quot;</span><span class="p">),</span>
        <span class="s2">&quot;integer&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^[+-]?[0-9]+$&quot;</span><span class="p">),</span>
        <span class="s2">&quot;array&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;\\[\\s*(.*)\\s*\\]&quot;</span><span class="p">),</span>
        <span class="s2">&quot;map&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;\\{\\s*(.*)\\s*\\}&quot;</span><span class="p">),</span>
        <span class="s2">&quot;key_value&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;([a-z0-9_-][ a-z0-9_-]*):( .+)&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">),</span>
        <span class="s2">&quot;single_key_value&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^([a-z0-9_-][ a-z0-9_-]*):( .+?)$&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">),</span>
        <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;([a-z0-9_-][ a-z0-9_-]+):( .+)?&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">),</span>
        <span class="s2">&quot;item&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^-\\s+&quot;</span><span class="p">),</span>
        <span class="s2">&quot;trim&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^\\s+|\\s+$&quot;</span><span class="p">),</span>
        <span class="s2">&quot;comment&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;([^\\\&#39;\\\&quot;#]+([\\\&#39;\\\&quot;][^\\\&#39;\\\&quot;]*[\\\&#39;\\\&quot;])*)*(#.*)?&quot;</span><span class="p">)</span>
      <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">Block</span><span class="p">(</span><span class="nx">lvl</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span> <span class="cm">/* The block&#39;s parent */</span>
        <span class="nx">parent</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="cm">/* Number of children */</span>
        <span class="nx">length</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="cm">/* Block&#39;s level */</span>
        <span class="nx">level</span><span class="o">:</span> <span class="nx">lvl</span><span class="p">,</span>
        <span class="cm">/* Lines of code to process */</span>
        <span class="nx">lines</span><span class="o">:</span> <span class="p">[],</span>
        <span class="cm">/* Blocks with greater level */</span>
        <span class="nx">children</span><span class="o">:</span> <span class="p">[],</span>
        <span class="cm">/* Add a block to the children collection */</span>
        <span class="nx">addChild</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
          <span class="nx">obj</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
          <span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">parser</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">regLevel</span> <span class="o">=</span> <span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;regLevel&quot;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">invalidLine</span> <span class="o">=</span> <span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;invalidLine&quot;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">m</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">curLevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">blocks</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Block</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">currentBlock</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Block</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">currentBlock</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

      <span class="nx">blocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currentBlock</span><span class="p">);</span>
      <span class="nx">levels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">level</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">line</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">invalidLine</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">regLevel</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">line</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">level</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="nx">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">level</span> <span class="o">&gt;</span> <span class="nx">curLevel</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">oldBlock</span> <span class="o">=</span> <span class="nx">currentBlock</span><span class="p">;</span>
          <span class="nx">currentBlock</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Block</span><span class="p">(</span><span class="nx">level</span><span class="p">);</span>
          <span class="nx">oldBlock</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">currentBlock</span><span class="p">);</span>
          <span class="nx">blocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currentBlock</span><span class="p">);</span>
          <span class="nx">levels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">level</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">level</span> <span class="o">&lt;</span> <span class="nx">curLevel</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">added</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

          <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(;</span> <span class="nx">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">levels</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">==</span> <span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">currentBlock</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Block</span><span class="p">(</span><span class="nx">level</span><span class="p">);</span>
              <span class="nx">blocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currentBlock</span><span class="p">);</span>
              <span class="nx">levels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">level</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">parent</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">parent</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">currentBlock</span><span class="p">);</span>
              <span class="nx">added</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">added</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">currentBlock</span><span class="p">.</span><span class="nx">lines</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;trim&quot;</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">));</span>
        <span class="nx">curLevel</span> <span class="o">=</span> <span class="nx">level</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">processValue</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">val</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;trim&quot;</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;.NaN&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Number</span><span class="p">.</span><span class="kc">NaN</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;.inf&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">POSITIVE_INFINITY</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">==</span> <span class="s1">&#39;-.inf&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">NEGATIVE_INFINITY</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;dashesString&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;quotesString&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;integer&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;single_key_value&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">res</span><span class="p">[</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">processValue</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;array&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">c</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">lenJ</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">lenJ</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nx">j</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;\&#39;&#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">str</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
              <span class="nx">content</span> <span class="o">+=</span> <span class="nx">c</span><span class="p">;</span>
              <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;\&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">str</span> <span class="o">==</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">str</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">str</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
              <span class="nx">content</span> <span class="o">+=</span> <span class="nx">c</span><span class="p">;</span>
              <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="o">++</span><span class="nx">count</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;]&#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;}&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="o">--</span><span class="nx">count</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nx">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">processValue</span><span class="p">(</span><span class="nx">content</span><span class="p">));</span>
            <span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nx">content</span> <span class="o">+=</span> <span class="nx">c</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">processValue</span><span class="p">(</span><span class="nx">content</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;map&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">c</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">lenJ</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">lenJ</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nx">j</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;\&#39;&#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">str</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
              <span class="nx">content</span> <span class="o">+=</span> <span class="nx">c</span><span class="p">;</span>
              <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;\&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">str</span> <span class="o">==</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">str</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">))</span> <span class="p">{</span>
              <span class="nx">str</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
              <span class="nx">content</span> <span class="o">+=</span> <span class="nx">c</span><span class="p">;</span>
              <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="o">++</span><span class="nx">count</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;]&#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;}&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="o">--</span><span class="nx">count</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nx">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
            <span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nx">content</span> <span class="o">+=</span> <span class="nx">c</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">newRes</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">lenJ</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">lenJ</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">res</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;key_value&quot;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">newRes</span><span class="p">[</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">processValue</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">newRes</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">processFoldedBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">lines</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">chunks</span> <span class="o">=</span> <span class="p">[</span><span class="nx">str</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">chunks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">processFoldedBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">chunks</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">processLiteralBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">lines</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nx">processLiteralBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">processBlock</span><span class="p">(</span><span class="nx">blocks</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">currentObj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">processedBlocks</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="kd">var</span> <span class="nx">isMap</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">lenJ</span> <span class="o">=</span> <span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">lenJ</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">level</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">level</span> <span class="o">!=</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">level</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

        <span class="nx">processedBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span>

        <span class="nx">level</span> <span class="o">=</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">level</span><span class="p">;</span>
        <span class="nx">lines</span> <span class="o">=</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">lines</span><span class="p">;</span>
        <span class="nx">children</span> <span class="o">=</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">children</span><span class="p">;</span>
        <span class="nx">currentObj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">line</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">key</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;item&quot;</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">isMap</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">isMap</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="p">}</span>
              <span class="p">}</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currentObj</span><span class="p">);</span>
              <span class="nx">currentObj</span> <span class="o">=</span> <span class="p">{};</span>
              <span class="nx">isMap</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;trim&quot;</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">nb</span> <span class="o">=</span> <span class="nx">processBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">currentObj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">nb</span><span class="p">;</span>
                <span class="k">else</span> <span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">nb</span><span class="p">;</span>
                <span class="nx">reference_blocks</span><span class="p">[</span><span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">nb</span><span class="p">;</span>
              <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">currentObj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processLiteralBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
                <span class="k">else</span> <span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processLiteralBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
              <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">no</span> <span class="o">=</span> <span class="p">{};</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">reference_blocks</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">reference_blocks</span><span class="p">[</span><span class="nx">v</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">no</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">reference_blocks</span><span class="p">[</span><span class="nx">v</span><span class="p">][</span><span class="nx">k</span><span class="p">];</span>
                  <span class="p">}</span>

                  <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">currentObj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">no</span><span class="p">;</span>
                  <span class="k">else</span> <span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">no</span><span class="p">;</span>
                <span class="p">}</span>
              <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">currentObj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processFoldedBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
                <span class="k">else</span> <span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processFoldedBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">currentObj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processValue</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                <span class="k">else</span> <span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processValue</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">currentObj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">);</span>
              <span class="k">else</span> <span class="nx">res</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processBlock</span><span class="p">(</span><span class="nx">children</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^-\s*$/</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">isMap</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">isMap</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currentObj</span><span class="p">);</span>
            <span class="nx">currentObj</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">isMap</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^-\s*(.*)/</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">currentObj</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">processValue</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">isMap</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">isMap</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="p">}</span>
              <span class="p">}</span>
              <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">processValue</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
            <span class="p">}</span>
            <span class="k">continue</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">currentObj</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isMap</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">isMap</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currentObj</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">processedBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">blocks</span><span class="p">.</span><span class="nx">splice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">blocks</span><span class="p">,</span> <span class="nx">processedBlocks</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">semanticAnalysis</span><span class="p">(</span><span class="nx">blocks</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">processBlock</span><span class="p">(</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">children</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">preProcess</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">regex</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">];</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">lines</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">reference_blocks</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">var</span> <span class="nx">pre</span> <span class="o">=</span> <span class="nx">preProcess</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
      <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">(</span><span class="nx">pre</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">semanticAnalysis</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nb">eval</span><span class="o">:</span> <span class="nb">eval</span>
    <span class="p">}</span>
  <span class="p">})();</span></pre></div>
      </td>
    </tr>
    <tr id='section-Start_Load'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Start_Load">&#182;</a>
        </div>
        <h2>Start Load</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre>  </pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p>Grab the gettit script tag, parse the attributes, and load assets.
If gettit is script loaded asynchronously, then it&rsquo;s required to be the first child of the <code>head</code> or <code>documentElement</code>.
Otherwise, if it was loaded with a normal <code>&lt;script&gt;</code> include, it should be the last script loaded (so far) on the page.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">firstChild</span> <span class="o">=</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">firstChild</span> <span class="o">&amp;&amp;</span> <span class="nx">firstChild</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="s1">&#39;SCRIPT&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">firstChild</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;gettit&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">tag</span> <span class="o">=</span> <span class="nx">firstChild</span><span class="p">;</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
    <span class="nx">tag</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">[</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="nx">load</span><span class="p">({</span>
    <span class="nx">isDebugging</span><span class="o">:</span> <span class="p">((</span><span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;debug_assets=(.+?)(&amp;|$)&#39;</span><span class="p">).</span><span class="nx">exec</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">)</span><span class="o">||</span><span class="p">[,</span><span class="kc">null</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span><span class="p">),</span>
    <span class="nx">jsAssets</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">assets</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">each</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-js-assets&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-js-assets&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">js</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">assets</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="nx">js</span><span class="p">));</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">assets</span><span class="p">;</span>
    <span class="p">})(),</span>
    <span class="nx">cssAssets</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">assets</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">each</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-css-assets&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-css-assets&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">css</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">assets</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="nx">css</span><span class="p">));</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">assets</span><span class="p">;</span>
    <span class="p">})(),</span>
    <span class="nx">assets</span><span class="o">:</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-assets&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">env</span><span class="o">:</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-env&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">path</span><span class="o">:</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-env-path&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">version</span><span class="o">:</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-version&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="nx">cb</span><span class="o">:</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-callback&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span>
  <span class="p">});</span>
  
<span class="p">})();</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
